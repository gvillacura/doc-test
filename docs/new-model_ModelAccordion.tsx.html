

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> new-model/ModelAccordion.tsx</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Components / Results</h3><ul><li><a href="BarGraphModal.html">BarGraphModal</a></li><li><a href="ColorsScale.html">ColorsScale</a></li><li><a href="DoubleYAxis.html">DoubleYAxis</a></li><li><a href="GraphAndMapMetaModal.html">GraphAndMapMetaModal</a></li><li><a href="GraphAndMapMonoModal.html">GraphAndMapMonoModal</a></li><li><a href="GraphicAndMapResults.html">GraphicAndMapResults</a></li><li><a href="GraphModal.html">GraphModal</a></li><li><a href="MapResults.html">MapResults</a></li><li><a href="MetaMapResults.html">MetaMapResults</a></li><li><a href="MetapopulationSelectTable.html">MetapopulationSelectTable</a></li><li><a href="PlayDataSlider.html">PlayDataSlider</a></li><li><a href="RealDataCheckBoxs.html">RealDataCheckBoxs</a></li><li><a href="ResultsDrawer.html">ResultsDrawer</a></li><li><a href="ResultsMapsSelection.html">ResultsMapsSelection</a></li><li><a href="ResultsSelection.html">ResultsSelection</a></li></ul><h3>Components</h3><ul><li><a href="CountiesSelect.html">CountiesSelect</a></li><li><a href="GeoSelectionsTab.html">GeoSelectionsTab</a></li><li><a href="NumberInputEpi.html">NumberInputEpi</a></li><li><a href="NumberInputVariableDependent.html">NumberInputVariableDependent</a></li><li><a href="ResetAlerts.html">ResetAlerts</a></li><li><a href="SelectedFeaturesPanel.html">SelectedFeaturesPanel</a></li><li><a href="StatesSelect.html">StatesSelect</a></li><li><a href="StatesSelectedCheckbox.html">StatesSelectedCheckbox</a></li></ul><h3>Components / DataFitTab</h3><ul><li><a href="EndPointSource.html">EndPointSource</a></li><li><a href="FileSource.html">FileSource</a></li><li><a href="FitParameterTable.html">FitParameterTable</a></li><li><a href="FitParemetersTabs.html">FitParemetersTabs</a></li><li><a href="GraphicDataFit.html">GraphicDataFit</a></li><li><a href="MetapopulationDataFit.html">MetapopulationDataFit</a></li><li><a href="MonopopulationDataFit.html">MonopopulationDataFit</a></li><li><a href="NodeSearchFilter.html">NodeSearchFilter</a></li><li><a href="SampleSource.html">SampleSource</a></li></ul><h3>Components / models-tab</h3><ul><li><a href="ExportModels.html">ExportModels</a></li><li><a href="ImportModels.html">ImportModels</a></li></ul><h3>Components / MapTab</h3><ul><li><a href="GeoSelectionsDetails.html">GeoSelectionsDetails</a></li><li><a href="GeoToastMessage.html">GeoToastMessage</a></li><li><a href="SelectorMap.html">SelectorMap</a></li><li><a href="SelectorMapAccordion.html">SelectorMapAccordion</a></li></ul><h3>Components / NewModel</h3><ul><li><a href="InitialConditiosModels.html">InitialConditiosModels</a></li><li><a href="ModelAccordion.html">ModelAccordion</a></li><li><a href="ModelBuilder.html">ModelBuilder</a></li><li><a href="ModelController.html">ModelController</a></li><li><a href="ModelMainTab.html">ModelMainTab</a></li><li><a href="SelectDate.html">SelectDate</a></li></ul><h3>Components / Summary tab</h3><ul><li><a href="RunButton.html">RunButton</a></li><li><a href="TableSimulations.html">TableSimulations</a></li></ul><h3>Global</h3><ul><li><a href="global.html#getArrayParametersByNode">getArrayParametersByNode</a></li><li><a href="global.html#getColor">getColor</a></li><li><a href="global.html#getGeoNames">getGeoNames</a></li><li><a href="global.html#getInitialConditionsByModel">getInitialConditionsByModel</a></li><li><a href="global.html#getMetaObj">getMetaObj</a></li><li><a href="global.html#getParametersFitModel">getParametersFitModel</a></li><li><a href="global.html#getPreviusInitialConditions">getPreviusInitialConditions</a></li><li><a href="global.html#getSEIRHVDObjMono">getSEIRHVDObjMono</a></li><li><a href="global.html#getSEIRObjMono">getSEIRObjMono</a></li><li><a href="global.html#getSIRObjMono">getSIRObjMono</a></li><li><a href="global.html#postInitialConditionsByModel">postInitialConditionsByModel</a></li></ul></div><div class="category"><h2>DataFitTab</h2><h3>Components</h3><ul><li><a href="DataFitTab.html">DataFitTab</a></li></ul></div><div class="category"><h2>MapTab</h2><h3>Components</h3><ul><li><a href="Map.html">Map</a></li></ul></div><div class="category"><h2>NewModel</h2><h3>Components</h3><ul><li><a href="NewModel.html">NewModel</a></li></ul></div><div class="category"><h2>Results</h2><h3>Components</h3><ul><li><a href="Results.html">Results</a></li></ul></div><div class="category"><h2>Summary tab</h2><h3>Components</h3><ul><li><a href="SummaryTab.html">SummaryTab</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>new-model/ModelAccordion.tsx</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { EditIcon, InfoIcon } from "@chakra-ui/icons";
import {
    AccordionItem,
    AccordionButton,
    AccordionPanel,
    AccordionIcon,
    Box,
    Text,
    Input,
    RadioGroup,
    Stack,
    Radio,
    Select,
    NumberInput,
    NumberInputField,
    NumberInputStepper,
    NumberIncrementStepper,
    NumberDecrementStepper,
    IconButton,
    Flex,
    Tooltip,
} from "@chakra-ui/react";
import { format } from "date-fns";
import React, { useCallback, useContext, useEffect, useState } from "react";

import { NewModelSetted } from "context/NewModelsContext";
import { SelectFeature } from "context/SelectFeaturesContext";
import countiesData from "data/counties.json";
import stateData from "data/states.json";

import getInitialConditionsByModel, {
    getPreviusInitialConditions,
} from "./initialConditionsByModel";

interface Props {
    modelName: string;
    setModelName: (value: string) => void;
    modelValue: string;
    setModelValue: (value: string) => void;
    populationValue: string;
    setPopulationValue: (value: string) => void;
    numberOfNodes: number;
    setNumberOfNodes: (value: number) => void;
    dataSourceValue: undefined | string;
    setDataSourceValue: (value: string) => void;
    areaSelectedValue: undefined | string | number;
    setAreaSelectedValue: (value: number | string) => void;
    graphId: number;
    setGraphId: (value: number) => void;
    id: number;
    showSectionInitialConditions: boolean;
    setShowSectionInitialConditions: (value: boolean) => void;
    graphsSelectedValue: undefined | string[];
    setGraphsSelectedValue: (value: string[]) => void;
}

/**
 * Accordion with the necessary configurations to create a model.
 * @subcategory NewModel
 * @component
 */
const ModelAccordion = ({
    modelName,
    setModelName,
    modelValue,
    setModelValue,
    populationValue,
    setPopulationValue,
    numberOfNodes,
    setNumberOfNodes,
    dataSourceValue,
    setDataSourceValue,
    areaSelectedValue,
    setAreaSelectedValue,
    graphId,
    setGraphId,
    id,
    showSectionInitialConditions,
    setShowSectionInitialConditions,
    graphsSelectedValue,
    setGraphsSelectedValue,
}: Props) => {
    const [numberOfGraphs, setNumberOfGraphs] = useState(undefined);
    const [isDisabled, setIsDisabled] = useState(false);
    const [geoSelections, setGeoSelections] = useState([]);
    const [minGraphValue, setMinGraphValue] = useState(2);
    const { geoSelections: allGeoSelections } = useContext(SelectFeature);
    const { newModel, setNewModel } = useContext(NewModelSetted);

    useEffect(() => {
        if (populationValue === "monopopulation") {
            setIsDisabled(true);
            setNumberOfGraphs(1);
            setMinGraphValue(1);
        } else {
            setIsDisabled(false);
            setNumberOfGraphs(2);
            setMinGraphValue(2);
        }
    }, [populationValue]);

    /**
     * Returns the saved value of the requested parameter.
     */
    const getDefaultValueParameters = useCallback(
        (field) => {
            return newModel.find(({ idNewModel }) => idNewModel === id)[field];
        },
        [newModel, id]
    );

    useEffect(() => {
        if (
            dataSourceValue === "graph" &amp;&amp;
            graphId !== 0 &amp;&amp;
            graphId !== undefined
        ) {
            setNumberOfGraphs(getDefaultValueParameters("numberNodes"));
        }
    }, [dataSourceValue, getDefaultValueParameters, graphId]);

    useEffect(() => {
        if (modelValue === "seirhvd") {
            const getGeoSelectionNoCounties = [...allGeoSelections].filter(
                (e) => {
                    return e.scale !== "Counties";
                }
            );
            setGeoSelections(getGeoSelectionNoCounties);
        } else {
            setGeoSelections(allGeoSelections);
        }
    }, [modelValue, allGeoSelections]);

    let graphsArray = [];
    /**
     * Returns a list with the names of the nodes format: "Node + index of the node".
     * @param {number} graphsNumber number of model nodes.
     * @returns {string[]}
     */
    const getGraphsNamesArray = (graphsNumber) => {
        for (let i = 0; i &lt; graphsNumber; i += 1) {
            const graphName = `Node ${i + 1}`;
            graphsArray = [...graphsArray, graphName];
        }
        return graphsArray;
    };

    /**
     * Returns the initial conditions for graphs.
     * @param {string[]} graphsValuesArray list with node names.
     * @returns {InitialConditionsNewModel}
     */
    const getInitialConditionsGraphsArray = (graphsValuesArray) => {
        const previusInitialConditions =
            getDefaultValueParameters("initialConditions");
        const previusTypeSelection = getDefaultValueParameters("typeSelection");

        if (
            previusInitialConditions.length > 0 &amp;&amp;
            previusTypeSelection !== "geographic"
        ) {
            return graphsValuesArray.map((graph, index) => {
                return {
                    name: graph,
                    conditionsValues: getPreviusInitialConditions(
                        modelValue,
                        previusInitialConditions[index].conditionsValues
                    ),
                };
            });
        }
        return graphsValuesArray.map((graph) => {
            return {
                name: graph,
                conditionsValues: getInitialConditionsByModel(modelValue),
            };
        });
    };

    useEffect(() => {
        if (areaSelectedValue !== "" &amp;&amp; areaSelectedValue !== undefined) {
            setAreaSelectedValue(getDefaultValueParameters("idGeo"));
        } else {
            setAreaSelectedValue(getDefaultValueParameters(undefined));
        }

        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [getDefaultValueParameters, areaSelectedValue]);
    /* dispatch to simulationContext data about type selection 
  when select value is changed. Besides, modify other contexts values */

    /**
     * Provides the initial conditions for geographic areas.
     * @param scale scale of geographic selection.
     * @param {string[]} featureSelected list with county or state fips.
     * @returns {InitialConditionsNewModel}
     */
    const getInitialConditionsGeoArray = (scale, featureSelected) => {
        return featureSelected.map((feature) => {
            if (scale === "States") {
                return {
                    name: stateData.data.find(
                        (state) => state[0] === feature
                    )[2],
                    conditionsValues: getInitialConditionsByModel(modelValue),
                };
            }
            return {
                name: countiesData.data.find(
                    (state) => state[5] === feature
                )[7],
                conditionsValues: getInitialConditionsByModel(modelValue),
            };
        });
    };

    const getInitialConditions = (graphsValuesArray) => {
        let initialConditionsValue;
        const geoSelected = allGeoSelections.find((geoSelection) => {
            return geoSelection.id === +areaSelectedValue;
        });
        if (dataSourceValue === "graph") {
            initialConditionsValue =
                getInitialConditionsGraphsArray(graphsValuesArray);
        }
        if (dataSourceValue === "geographic") {
            initialConditionsValue =
                numberOfNodes === 1
                    ? [
                          {
                              name: geoSelected.name,
                              conditionsValues:
                                  getInitialConditionsByModel(modelValue),
                          },
                      ]
                    : getInitialConditionsGeoArray(
                          geoSelected.scale,
                          geoSelected.featureSelected
                      );
        }
        return initialConditionsValue;
    };

    return (
        &lt;AccordionItem>
            &lt;h2>
                &lt;AccordionButton
                    color="#16609E"
                    border="none"
                    borderBottom="2px solid #16609E"
                    _focus={{ boxShadow: "none" }}
                >
                    &lt;Box flex="1" textAlign="left">
                        Model
                    &lt;/Box>
                    &lt;AccordionIcon />
                &lt;/AccordionButton>
            &lt;/h2>
            &lt;AccordionPanel pb={4} bg="#FFFFFF">
                &lt;Box mb="3%">
                    &lt;Text fontSize="14px" fontWeight={500}>
                        Model Name
                    &lt;/Text>
                    &lt;Input
                        w="13rem"
                        placeholder="Add model name"
                        size="sm"
                        onChange={(e) => {
                            setModelName(e.target.value);
                        }}
                        onBlur={(e) => {
                            setNewModel({
                                type: "update",
                                target: "name",
                                element: e.target.value,
                                id,
                            });
                        }}
                        value={modelName}
                    />
                &lt;/Box>
                &lt;Box mb="3%">
                    &lt;Text fontSize="14px" fontWeight={500}>
                        Model
                    &lt;/Text>
                    &lt;RadioGroup
                        size="sm"
                        mt="1%"
                        value={modelValue}
                        onChange={(e) => {
                            setNumberOfNodes(0);
                            setModelValue(e);
                            setAreaSelectedValue("");
                            setGraphId(undefined);
                        }}
                    >
                        &lt;Stack direction="row" spacing="24px">
                            &lt;Radio value="sir">SIR&lt;/Radio>
                            &lt;Radio value="seir">SEIR&lt;/Radio>
                            &lt;Radio value="seirhvd">SEIRHVD&lt;/Radio>
                        &lt;/Stack>
                    &lt;/RadioGroup>
                &lt;/Box>
                &lt;Box mb="3%">
                    &lt;Text fontSize="14px" fontWeight={500}>
                        Type of population
                    &lt;/Text>
                    &lt;RadioGroup
                        size="sm"
                        mt="1%"
                        value={populationValue}
                        onChange={(e) => {
                            setPopulationValue(e);
                            setAreaSelectedValue("");
                            setNumberOfNodes(0);
                            setGraphId(undefined);
                        }}
                    >
                        &lt;Stack direction="row" spacing="24px">
                            &lt;Radio value="monopopulation">Monopopulation&lt;/Radio>
                            &lt;Radio value="metapopulation">Metapopulation&lt;/Radio>
                        &lt;/Stack>
                    &lt;/RadioGroup>
                &lt;/Box>
                &lt;Box mb="3%">
                    &lt;Text fontSize="14px" fontWeight={500}>
                        Data Source
                    &lt;/Text>
                    &lt;RadioGroup
                        size="sm"
                        mt="1%"
                        value={dataSourceValue}
                        onChange={(e) => {
                            setDataSourceValue(e);
                            setAreaSelectedValue("");
                            setNumberOfNodes(0);
                            setGraphId(undefined);
                        }}
                    >
                        &lt;Stack direction="row" spacing="24px">
                            &lt;Radio value="graph">Graph&lt;/Radio>
                            &lt;Radio value="geographic">Geographic&lt;/Radio>
                        &lt;/Stack>
                    &lt;/RadioGroup>
                &lt;/Box>
                {dataSourceValue === "graph" &amp;&amp; (
                    &lt;Flex mb="3%" alignItems="end">
                        &lt;Box>
                            &lt;Text fontSize="14px" fontWeight={500}>
                                Number of nodes
                            &lt;/Text>
                            &lt;NumberInput
                                size="sm"
                                defaultValue={2}
                                min={minGraphValue}
                                max={30}
                                value={numberOfGraphs}
                                onChange={(e) => {
                                    setNumberOfGraphs(+e);
                                }}
                                isDisabled={isDisabled}
                            >
                                &lt;NumberInputField />
                                &lt;NumberInputStepper>
                                    &lt;NumberIncrementStepper />
                                    &lt;NumberDecrementStepper />
                                &lt;/NumberInputStepper>
                            &lt;/NumberInput>
                        &lt;/Box>
                        &lt;IconButton
                            aria-label="Search database"
                            bg="#16609E"
                            color="#FFFFFF"
                            size="sm"
                            ml="5%"
                            icon={&lt;EditIcon />}
                            onClick={() => {
                                setNumberOfNodes(numberOfGraphs);
                                const graphsValuesArray =
                                    getGraphsNamesArray(numberOfGraphs);
                                setGraphsSelectedValue(graphsValuesArray);
                                setGraphId(1);
                                setShowSectionInitialConditions(true);
                                setAreaSelectedValue(undefined);

                                setNewModel({
                                    type: "update-all",
                                    id,
                                    payload: {
                                        idNewModel: id,
                                        name: modelName,
                                        modelType: modelValue,
                                        populationType: populationValue,
                                        typeSelection: dataSourceValue,
                                        idGeo: undefined,
                                        idGraph: 1,
                                        numberNodes: numberOfGraphs,
                                        t_init: format(
                                            new Date(2021, 11, 31),
                                            "yyyy/MM/dd"
                                        ),
                                        initialConditions:
                                            getInitialConditionsGraphsArray(
                                                graphsValuesArray
                                            ),
                                    },
                                });
                            }}
                        />
                        &lt;Tooltip label="Set Initial conditions to register model">
                            &lt;IconButton
                                aria-label="Search database"
                                bg="#FFFFFF"
                                color="#16609E"
                                size="sm"
                                ml="5%"
                                icon={&lt;InfoIcon />}
                            />
                        &lt;/Tooltip>
                    &lt;/Flex>
                )}
                {dataSourceValue === "geographic" &amp;&amp; (
                    &lt;Box mb="3%">
                        &lt;Text fontSize="14px" fontWeight={500}>
                            Area Selected
                        &lt;/Text>
                        &lt;Flex>
                            &lt;Select
                                w="13rem"
                                fontSize="14px"
                                size="sm"
                                placeholder="Name Selection"
                                value={areaSelectedValue}
                                onChange={(e) => {
                                    if (e.target.value !== "") {
                                        setAreaSelectedValue(+e.target.value);
                                        const geoSelected =
                                            allGeoSelections.find(
                                                (geoSelection) => {
                                                    return (
                                                        geoSelection.id ===
                                                        +e.target.value
                                                    );
                                                }
                                            );
                                        const numberGeoNodes =
                                            populationValue === "monopopulation"
                                                ? 1
                                                : geoSelected.featureSelected
                                                      .length;
                                        setNumberOfNodes(numberGeoNodes);
                                        setNumberOfNodes(
                                            geoSelected.featureSelected.length
                                        );
                                        setGraphId(undefined);

                                        setNewModel({
                                            type: "update-all",
                                            id,
                                            payload: {
                                                idNewModel: id,
                                                name: modelName,
                                                modelType: modelValue,
                                                populationType: populationValue,
                                                typeSelection: dataSourceValue,
                                                idGeo: +e.target.value,
                                                idGraph: undefined,
                                                numberNodes: numberGeoNodes,
                                                t_init: format(
                                                    new Date(2022, 4, 31),
                                                    "yyyy/MM/dd"
                                                ),
                                                initialConditions:
                                                    numberGeoNodes === 1
                                                        ? [
                                                              {
                                                                  name: geoSelected.name,
                                                                  conditionsValues:
                                                                      getInitialConditionsByModel(
                                                                          modelValue
                                                                      ),
                                                              },
                                                          ]
                                                        : getInitialConditionsGeoArray(
                                                              geoSelected.scale,
                                                              geoSelected.featureSelected
                                                          ),
                                            },
                                        });
                                    } else {
                                        setAreaSelectedValue("");
                                        setNumberOfNodes(0);
                                    }
                                }}
                            >
                                {allGeoSelections.length > 0 &amp;&amp;
                                    geoSelections.map((e) => {
                                        return (
                                            &lt;option key={e.id} value={e.id}>
                                                {e.name}
                                            &lt;/option>
                                        );
                                    })}
                            &lt;/Select>
                            &lt;IconButton
                                aria-label="Search database"
                                bg="#16609E"
                                color="#FFFFFF"
                                size="sm"
                                ml="5%"
                                icon={&lt;EditIcon />}
                                onClick={() => {
                                    setShowSectionInitialConditions(true);
                                }}
                            />
                            &lt;Tooltip label="Set Initial conditions to register model">
                                &lt;IconButton
                                    aria-label="Search database"
                                    bg="#FFFFFF"
                                    color="#16609E"
                                    size="sm"
                                    ml="5%"
                                    icon={&lt;InfoIcon />}
                                />
                            &lt;/Tooltip>
                        &lt;/Flex>
                    &lt;/Box>
                )}
            &lt;/AccordionPanel>
        &lt;/AccordionItem>
    );
};

export default ModelAccordion;
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
