

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> results-tab/ResultsSelection.tsx</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Components / Results</h3><ul><li><a href="BarGraphModal.html">BarGraphModal</a></li><li><a href="ColorsScale.html">ColorsScale</a></li><li><a href="DoubleYAxis.html">DoubleYAxis</a></li><li><a href="GraphAndMapMetaModal.html">GraphAndMapMetaModal</a></li><li><a href="GraphAndMapMonoModal.html">GraphAndMapMonoModal</a></li><li><a href="GraphicAndMapResults.html">GraphicAndMapResults</a></li><li><a href="GraphModal.html">GraphModal</a></li><li><a href="MapResults.html">MapResults</a></li><li><a href="MetaMapResults.html">MetaMapResults</a></li><li><a href="MetapopulationSelectTable.html">MetapopulationSelectTable</a></li><li><a href="PlayDataSlider.html">PlayDataSlider</a></li><li><a href="RealDataCheckBoxs.html">RealDataCheckBoxs</a></li><li><a href="ResultsDrawer.html">ResultsDrawer</a></li><li><a href="ResultsMapsSelection.html">ResultsMapsSelection</a></li><li><a href="ResultsSelection.html">ResultsSelection</a></li></ul><h3>Components</h3><ul><li><a href="CountiesSelect.html">CountiesSelect</a></li><li><a href="GeoSelectionsTab.html">GeoSelectionsTab</a></li><li><a href="NumberInputEpi.html">NumberInputEpi</a></li><li><a href="NumberInputVariableDependent.html">NumberInputVariableDependent</a></li><li><a href="ResetAlerts.html">ResetAlerts</a></li><li><a href="SelectedFeaturesPanel.html">SelectedFeaturesPanel</a></li><li><a href="StatesSelect.html">StatesSelect</a></li><li><a href="StatesSelectedCheckbox.html">StatesSelectedCheckbox</a></li></ul><h3>Components / DataFitTab</h3><ul><li><a href="EndPointSource.html">EndPointSource</a></li><li><a href="FileSource.html">FileSource</a></li><li><a href="FitParameterTable.html">FitParameterTable</a></li><li><a href="FitParemetersTabs.html">FitParemetersTabs</a></li><li><a href="GraphicDataFit.html">GraphicDataFit</a></li><li><a href="MetapopulationDataFit.html">MetapopulationDataFit</a></li><li><a href="MonopopulationDataFit.html">MonopopulationDataFit</a></li><li><a href="NodeSearchFilter.html">NodeSearchFilter</a></li><li><a href="SampleSource.html">SampleSource</a></li></ul><h3>Components / models-tab</h3><ul><li><a href="ExportModels.html">ExportModels</a></li><li><a href="ImportModels.html">ImportModels</a></li></ul><h3>Components / MapTab</h3><ul><li><a href="GeoSelectionsDetails.html">GeoSelectionsDetails</a></li><li><a href="GeoToastMessage.html">GeoToastMessage</a></li><li><a href="SelectorMap.html">SelectorMap</a></li><li><a href="SelectorMapAccordion.html">SelectorMapAccordion</a></li></ul><h3>Components / NewModel</h3><ul><li><a href="InitialConditiosModels.html">InitialConditiosModels</a></li><li><a href="ModelAccordion.html">ModelAccordion</a></li><li><a href="ModelBuilder.html">ModelBuilder</a></li><li><a href="ModelController.html">ModelController</a></li><li><a href="ModelMainTab.html">ModelMainTab</a></li><li><a href="SelectDate.html">SelectDate</a></li></ul><h3>Components / Summary tab</h3><ul><li><a href="RunButton.html">RunButton</a></li><li><a href="TableSimulations.html">TableSimulations</a></li></ul><h3>Global</h3><ul><li><a href="global.html#getArrayParametersByNode">getArrayParametersByNode</a></li><li><a href="global.html#getColor">getColor</a></li><li><a href="global.html#getGeoNames">getGeoNames</a></li><li><a href="global.html#getInitialConditionsByModel">getInitialConditionsByModel</a></li><li><a href="global.html#getMetaObj">getMetaObj</a></li><li><a href="global.html#getParametersFitModel">getParametersFitModel</a></li><li><a href="global.html#getPreviusInitialConditions">getPreviusInitialConditions</a></li><li><a href="global.html#getSEIRHVDObjMono">getSEIRHVDObjMono</a></li><li><a href="global.html#getSEIRObjMono">getSEIRObjMono</a></li><li><a href="global.html#getSIRObjMono">getSIRObjMono</a></li><li><a href="global.html#postInitialConditionsByModel">postInitialConditionsByModel</a></li></ul></div><div class="category"><h2>DataFitTab</h2><h3>Components</h3><ul><li><a href="DataFitTab.html">DataFitTab</a></li></ul></div><div class="category"><h2>MapTab</h2><h3>Components</h3><ul><li><a href="Map.html">Map</a></li></ul></div><div class="category"><h2>NewModel</h2><h3>Components</h3><ul><li><a href="NewModel.html">NewModel</a></li></ul></div><div class="category"><h2>Results</h2><h3>Components</h3><ul><li><a href="Results.html">Results</a></li></ul></div><div class="category"><h2>Summary tab</h2><h3>Components</h3><ul><li><a href="SummaryTab.html">SummaryTab</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>results-tab/ResultsSelection.tsx</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {
    Box,
    Flex,
    Accordion,
    AccordionItem,
    AccordionButton,
    AccordionPanel,
    AccordionIcon,
    Checkbox,
} from "@chakra-ui/react";
import React, { useEffect, useContext } from "react";

import { GraphicsData } from "context/GraphicsContext";
import { NewModelSetted } from "context/NewModelsContext";
import { TabIndex } from "context/TabContext";
import { SimulationKeysData } from "types/GraphicsTypes";
import { NewModelsAllParams } from "types/SimulationTypes";

import RealDataCheckBoxs from "./RealDataCheckBoxs";

/**
 * Component to select parameters to graph.
 * @subcategory Results
 * @component
 */
const ResultsSelection = () => {
    const { aux: responseSim } = useContext(TabIndex);
    const {
        simulationKeys,
        setSimulationKeys,
        savedSimulation,
        savedSimulationKeys,
        setSavedSimulationKeys,
        setSavedSimulation,
        checkedItems,
        setCheckedItems,
    } = useContext(GraphicsData);

    const model = ["S", "E", "I", "R"];
    const { completeModel } = useContext(NewModelSetted);

    /**
     * Includes or deletes a checked or unchecked parameter from the list.
     * @param {boolean} ischecked indicates whether the parameter was selected.
     * @param {string} id parameter name + simulation name.
     * @param {string} valueparameter name + simulation name.
     * @param {string} name simulation name.
     * @returns {string[]}
     */
    const saveKeys = (ischecked, id, value, name) => {
        const isInclude = savedSimulationKeys.includes(id);
        const isSimulationSaved = savedSimulation.filter((simulation) => {
            return simulation.name === name;
        });

        if (ischecked &amp;&amp; !isInclude) {
            if (isSimulationSaved.length === 0) {
                setSavedSimulation([
                    ...savedSimulation,
                    { name, keys: [value] },
                ]);
            } else {
                setSavedSimulation(
                    savedSimulation.map((simulation) => {
                        let simulationAux = simulation;
                        if (simulation.name === isSimulationSaved[0].name) {
                            simulationAux = {
                                name: simulation.name,
                                keys: [...simulation.keys, value],
                            };
                        }

                        return simulationAux;
                    })
                );
            }

            return setSavedSimulationKeys([...savedSimulationKeys, id]);
        }
        if (!ischecked &amp;&amp; isInclude) {
            let modifiedSimulations = savedSimulation.map((simulation) => {
                let simulationAux = simulation;
                if (simulation.name === isSimulationSaved[0]?.name) {
                    const simulationAuxFiltered = simulationAux.keys.filter(
                        (simulationValue) => simulationValue !== value
                    );
                    simulationAux = {
                        name: simulation.name,
                        keys: simulationAuxFiltered,
                    };
                }
                return simulationAux;
            });
            modifiedSimulations = modifiedSimulations.filter((simulation) => {
                return simulation.keys.length > 0;
            });
            setSavedSimulation(modifiedSimulations);
            return setSavedSimulationKeys(
                savedSimulationKeys.filter((key) => key !== id)
            );
        }
        return savedSimulationKeys;
    };

    /**
     * It unchecks all the parameters of the compartments, depending on the type of model, when the component is mounted.
     * @param {Array }graphicData list with the results of the simulations.
     * @returns {Object} object with the parameters of the compartments in false.
     */
    const setEmptyStateCheckedItems = (graphicData) => {
        const auxCheckedItems = {};
        graphicData.forEach((simulation) => {
            const keyList = {};
            Object.keys(simulation).forEach((key) => {
                if (model.includes(key)) {
                    keyList[key] = false;
                }
            });
            auxCheckedItems[simulation.name] = keyList;
        });

        return auxCheckedItems;
    };

    /**
     * Uncheck all child checks.
     * @param oneSimulationKeysData object with all the parameters and their values.
     */
    const deleteChildChecked = (oneSimulationKeysData: SimulationKeysData) => {
        /* delete for savedSimulationKeys */
        const savedSimulationKeysToDelete = model.map((key) => {
            return key + oneSimulationKeysData.name;
        });

        const newSavedSimulationKeys = savedSimulationKeys.filter(
            (savedSimulationKey) => {
                if (savedSimulationKeysToDelete.includes(savedSimulationKey)) {
                    return false;
                }
                return true;
            }
        );

        setSavedSimulationKeys(newSavedSimulationKeys);

        /* delete for savedSimulations */

        const oneSavedSimulation = savedSimulation.filter(
            (anotherSavedSimulation) => {
                return (
                    anotherSavedSimulation.name === oneSimulationKeysData.name
                );
            }
        )[0];

        const newOneSavedSimulation = {
            name: oneSavedSimulation?.name,
            keys: oneSavedSimulation?.keys.filter((key) => {
                if (model.includes(key)) {
                    return false;
                }
                return true;
            }),
        };

        let modifiedSimulations = savedSimulation.map(
            (anotherSavedSimulation) => {
                if (
                    anotherSavedSimulation.name === newOneSavedSimulation.name
                ) {
                    return newOneSavedSimulation;
                }
                return anotherSavedSimulation;
            }
        );

        modifiedSimulations = modifiedSimulations.filter(
            (anotherSavedSimulation) => {
                return anotherSavedSimulation.keys.length > 0;
            }
        );

        setSavedSimulation(modifiedSimulations);
    };

    let initialParameters = [];

    /**
     * @param simulation object with all the parameters and their values.
     * @returns {Array} list with the compartments according to model type.
     */
    const getCompartments = (simulation) => {
        let parametersCompartments = ["S", "E", "I", "R"];
        const simByName = completeModel.find(
            (sim: NewModelsAllParams) => sim.name === simulation.name
        );
        if (simByName?.parameters.name === "SEIRHVD") {
            parametersCompartments = ["S", "E", "I", "R"];
        } else {
            parametersCompartments = simByName?.parameters.compartments;
        }
        return parametersCompartments;
    };

    /**
     * Check all child checks.
     * @param oneSimulationKeysData object with all the parameters and their values.
     */
    const setChildChecked = (oneSimulationKeysData: SimulationKeysData) => {
        /* save for savedSimulationKeys */
        const savedSimulationKeysSave = getCompartments(
            oneSimulationKeysData
        ).map((key) => {
            return key + oneSimulationKeysData.name;
        });

        const simulationKeyIsInclude = savedSimulationKeysSave.filter((key) => {
            if (savedSimulationKeys.includes(key)) {
                return false;
            }
            return true;
        });

        setSavedSimulationKeys([
            ...savedSimulationKeys,
            ...simulationKeyIsInclude,
        ]);

        /* save for savedSimulations */

        // To check if a simulation with that name already exists.

        const isSimulationSaved = savedSimulation.filter((sim) => {
            return oneSimulationKeysData.name === sim.name;
        });

        /* save first parameter */
        if (isSimulationSaved.length === 0) {
            initialParameters = [
                ...initialParameters,
                {
                    name: oneSimulationKeysData.name,
                    keys: getCompartments(oneSimulationKeysData),
                },
            ];
            setSavedSimulation([...savedSimulation, ...initialParameters]);
        } else {
            const parametersToSet = model.filter((modelKey) => {
                if (isSimulationSaved[0].keys.includes(modelKey)) {
                    return false;
                }
                return true;
            });

            setSavedSimulation(
                savedSimulation.map((simulation) => {
                    let simulationAux = simulation;
                    if (simulation.name === isSimulationSaved[0].name) {
                        simulationAux = {
                            name: simulation.name,
                            keys: [...simulation.keys, ...parametersToSet],
                        };
                    }

                    return simulationAux;
                })
            );
        }
    };

    /**
     * Check if the Results check is checked and then check or uncheck all its child checks.
     * @param {Object} dataFilter object with all the parameters and their values.
     * @param {boolean} ischecked indicates whether check "Results" is checked.
     */
    const checkParentChecked = (dataFilter: SimulationKeysData, ischecked) => {
        if (ischecked) {
            setChildChecked(dataFilter);
        } else {
            deleteChildChecked(dataFilter);
        }
    };

    useEffect(() => {
        const graphicData = responseSim ? JSON.parse(responseSim) : "";
        if (graphicData) {
            setSimulationKeys(graphicData);
            setCheckedItems(setEmptyStateCheckedItems(graphicData));
        }
        setSavedSimulationKeys([]);
        setSavedSimulation([]);
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [responseSim]);

    return (
        &lt;Accordion
            key="results-selection-accordion"
            allowMultiple
            h="85%"
            overflowY="auto"
            overflowX="hidden"
        >
            {simulationKeys.map((simulation) => {
                return (
                    &lt;AccordionItem key={simulation.name}>
                        &lt;h2>
                            &lt;AccordionButton
                                color="#16609E"
                                border="none"
                                borderBottom="2px solid #16609E"
                                _focus={{ boxShadow: "none" }}
                            >
                                &lt;Box flex="1" textAlign="left">
                                    {simulation.name}
                                &lt;/Box>
                                &lt;AccordionIcon />
                            &lt;/AccordionButton>
                        &lt;/h2>
                        &lt;AccordionPanel pb={4} bg="#FFFFFF">
                            &lt;Accordion defaultIndex={[0]} allowMultiple>
                                &lt;Checkbox
                                    w="100%"
                                    m="2% 0"
                                    fontWeight={500}
                                    onChange={(e) => {
                                        const keyList = {};
                                        Object.keys(simulation).forEach(
                                            (key) => {
                                                const simCompartments =
                                                    getCompartments(simulation);
                                                if (
                                                    simCompartments.includes(
                                                        key
                                                    )
                                                ) {
                                                    keyList[key] =
                                                        e.target.checked;
                                                }
                                            }
                                        );
                                        setCheckedItems({
                                            ...checkedItems,
                                            [simulation.name]: keyList,
                                        });
                                        checkParentChecked(
                                            simulation,
                                            e.target.checked
                                        );
                                    }}
                                >
                                    Results
                                &lt;/Checkbox>
                                &lt;Flex flexWrap="wrap" ml="3%">
                                    {Object.keys(simulation).map((key) => {
                                        const simCompartments =
                                            getCompartments(simulation);
                                        if (simCompartments?.includes(key)) {
                                            return (
                                                &lt;Checkbox
                                                    isChecked={
                                                        checkedItems[
                                                            simulation.name
                                                        ][key]
                                                    }
                                                    size="sm"
                                                    m="2% 5%"
                                                    key={`${
                                                        key + simulation.name
                                                    }`}
                                                    id={`${
                                                        key + simulation.name
                                                    }`}
                                                    value={key}
                                                    onChange={(e) => {
                                                        setCheckedItems({
                                                            ...checkedItems,
                                                            [simulation.name]: {
                                                                ...checkedItems[
                                                                    simulation
                                                                        .name
                                                                ],
                                                                [key]: e.target
                                                                    .checked,
                                                            },
                                                        });

                                                        saveKeys(
                                                            e.target.checked,
                                                            e.target.id,
                                                            e.target.value,
                                                            simulation.name
                                                        );
                                                    }}
                                                >
                                                    {key}
                                                &lt;/Checkbox>
                                            );
                                        }
                                        return false;
                                    })}
                                &lt;/Flex>
                                &lt;Box
                                    w="100%"
                                    m="2% 7%"
                                    textAlign="start"
                                    fontWeight={500}
                                >
                                    Data
                                &lt;/Box>
                                &lt;Flex flexWrap="wrap" ml="3%">
                                    &lt;RealDataCheckBoxs
                                        simName={simulation.name}
                                        saveKeys={saveKeys}
                                    />
                                &lt;/Flex>
                                &lt;AccordionItem>
                                    &lt;h2>
                                        &lt;AccordionButton
                                            _focus={{ boxShadow: "none" }}
                                        >
                                            &lt;Box flex="1" textAlign="left">
                                                Other Data
                                            &lt;/Box>
                                            &lt;AccordionIcon />
                                        &lt;/AccordionButton>
                                    &lt;/h2>
                                    &lt;AccordionPanel pb={4}>
                                        &lt;Flex flexWrap="wrap">
                                            {Object.keys(simulation).map(
                                                (key) => {
                                                    const simCompartments =
                                                        getCompartments(
                                                            simulation
                                                        );
                                                    if (
                                                        !simCompartments?.includes(
                                                            key
                                                        ) &amp;&amp;
                                                        key !== "name"
                                                    ) {
                                                        return (
                                                            &lt;Checkbox
                                                                size="sm"
                                                                m="2% 5%"
                                                                value={key}
                                                                key={key}
                                                                id={`${
                                                                    key +
                                                                    simulation.name
                                                                }`}
                                                                // eslint-disable-next-line sonarjs/no-identical-functions
                                                                onChange={(
                                                                    e
                                                                ) => {
                                                                    saveKeys(
                                                                        e.target
                                                                            .checked,
                                                                        e.target
                                                                            .id,
                                                                        e.target
                                                                            .value,
                                                                        simulation.name
                                                                    );
                                                                }}
                                                            >
                                                                {key}
                                                            &lt;/Checkbox>
                                                        );
                                                    }
                                                    return false;
                                                }
                                            )}
                                        &lt;/Flex>
                                    &lt;/AccordionPanel>
                                &lt;/AccordionItem>
                            &lt;/Accordion>
                        &lt;/AccordionPanel>
                    &lt;/AccordionItem>
                );
            })}
        &lt;/Accordion>
    );
};

export default ResultsSelection;
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
